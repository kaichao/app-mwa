name: presto-search-line-dat.test
label: 单元测试
cluster: dcu
parameters:
  initial_status: RUNNING

jobs:
  presto-search:
    label: presto-search-line-test
    base_image: app-mwa/presto-search
    command: docker run -d
        --group-add video 
        --device /dev/kfd 
        --device /dev/dri
        --security-opt seccomp=unconfined 
        --network=host
        {{ENVS}} {{VOLUMES}} {{IMAGE}}
    environments:
      - LOCAL_INPUT_ROOT=${LOCAL_FITS_ROOT}
      - LOCAL_OUTPUT_ROOT=${LOCAL_SHM_ROOT}
      - ROCR_VISIBLE_DEVICES=${DEVICE_TO_USE}
      - SEARCHARGS=${SEARCHARGS}
    variables:
    # 1 hour
      max_sleep_count: 720
      slot_options: reserved_on_exit
      code_path: /raid0/zhzhang/app-mwa/dockerfiles/presto-modules/presto-search-line/code
    parameters:
      key_group_regex: ^(.+)$
      start_message: ${START_MESSAGE}
    hosts:
      - n1:1
