## 模块介绍
将单通道时间区间dat文件序列合并转换为单指向、单通道fits文件。

## 环境变量
  - 单通道文件的目录（DIR_DAT）
  - 定标文件目录（DIR_CAL）
  - 单通道数据文件目录(DIR_1CH)
## 输入消息格式：
  - ${观测号}/${起始时间戳}_${结尾时间戳}/${通道号}/${起始指向号}_${结尾执行好}
  - 例："1257010784/1257010986_1257011185/109/00001_00003"

## 用户应用的退出码
- 0 
## 输出消息格式
- 若退出码为0，则输出与输入消息相同的消息。

## 待完善部分
- 镜像精简，当前基础镜像
- 观测的时间戳UTT，放在观测数据集的元数据中（定标目录下的元数据定义文件）
- 输出结果中，将目录、输出文件中，将指向值放在目录、文件名，建议考虑用指向编号代替指向值（RA/Dec），因为指向值有特殊字符，不友好；
- PROJECT、NSETS是不是还需要？
- 1257010784_metafits_ppds.fits文件，目前在BASEDIR、DATDIR中都存在，移到定标目录CALDIR中，并且文件名中不包含观测编号？



## 性能测试数据

### 200秒数据 dat --> fits (单GPU)

|  指向数   | 指向均(秒) | 平均(秒) | 测试1(秒)  | 测试2(秒) | 测试3(秒) |
|  ----  | ---- | ---- | ---- | ---- | ---- |
| 1  | 51.35 | 51.35 | 50.83 | 51.73 | 51.49 |
| 3 | 29.52 | 88.56 | 84.13 | 95.96 | 85.60 |
| 5 | 23.96 | 119.82 | 118.55 | 121.66 | 119.25 |
| 10 | 20.79 | 207.91 | 211.12 | 205.26 | 207.33 |
| 20 | 18.93 | 378.56 | 382.84 | 372.62 | 380.59 |
| 30 | 18.66 | 559.94 | 555.07 | 557.64 | 567.12 |
| 40 | 19.12 | 764.81 | 768.76 | 766.78 | 758.89 |
| 60 | 19.03 | 1141.65 | 1151.35 | 1143.44 | 1130.15 |

- 执行数为120时，测试结果出错；
- 从效率看，单次计算指向数在30为最优，指向数的增加、减少都会导致效率增加，但都不明显；
- 从灵活性看，单次指向数越少，则的单个task的计算量更小，所需的磁盘空间也更小，就更灵活；
- 单次task的计算量太小，会导致task数量更多，增加管理开销；
- 综合考虑，建议单次处理的指向数为[20..80]区间。

### 不同数据长度的性能测试

|  指向数 | 30秒 | 60秒    | 90秒   | 120秒 | 150秒   | 180秒 |
|  ----  | ---- | ----   | ----   | ----  | ----   | ---- |
| 20     | 63.00| 123.40 | 174.49 | 232.34| 280.28 | 351.53 |
| 30     | 100.69| 177.57 | 259.93| 364.12| 420.11 | 503.56 |
| 40     | 129.46| 248.55 | 362.11| 468.63| 581.91 | 705.81 |
| 60     | 191.82| 362.31 | 527.90| 696.61| 860.36 | 1060.61 |
| 秒/指向 | 3.23| 6.08     |  8.83  |  11.74 |  14.28 | 17.48 |
| 毫秒/指向<br/>/秒数据 | 107.6| 101.3 | 98.1 | 97.9 |  95.2 | 97.1 |

- 从测试的科学需求看，数据越长，效果越好
- 从测试结果看，长度在90秒以上，性能影响不明显
- 单次处理的数据长度，会受到本地硬盘容量、内存容量？、DCU显存容量限制
- 原始观测产品数据量为18.8GB/分，30指向的fits文件数据为2.3GB/秒，合并后的fits文件，可以放到共享存储中再进行后续计算。
- 考虑临时工作空间，本地存储需求按25GB/(分数据)来确定，单次数据处理长度建议为按3-4分钟

### 50秒数据的多DCU测试（dat --> fits）


- 200秒数据 dat --> fits (4 GPU)

|  指向数 | 1dcu  | 2dcu | 2dcu_0 | 2dcu_1 | 4dcu | 4dcu_0 | 4dcu_1 | 4dcu_2 | 4dcu_3 |
|  ----  | ----  | ---- | ----   | ----   | ---- | ----   | ----   | ----   | ----   |
| 20     |       |      |        |        |      |        |        |        |        |
| 30     |       |      |        |        |      |        |        |        |        |
| 40     |       |      |        |        |      |        |        |        |        |
| 60     |       |      |        |        |      |        |        |        |        |


## 单观测数据集计算时间预估
- 数据集元数据
  - 24通道
  - 指向数：12000
  - 观测时间：4800秒
- 以单指向、单通道200秒数据的处理时间为20秒计
  - 总计算时间：24 * 12000 * 4800 / 10 = 1.4 * 10 ^ 8 秒 = 38400 小时 = 1600 天
  