name: pull-unpack.test
label: mwa-comput
cluster: ${CLUSTER}
parameters:
  initial_status: RUNNING
  message_router: message-router
  default_sleep_count: 20

jobs:
  pull-unpack:
    base_image: ${PULL_UNPACK}
    arguments:
      code_path: ${CODE_BASE}/pull-unpack/code
      slot_options: tmpfs_workdir
    environments:
      - SOURCE_URL=${SOURCE_URL}
      - SOURCE_JUMP_SERVERS=${SOURCE_JUMP_SERVERS}
      - TARGET_SUBDIR=${TARGET_SUBDIR}
      - TARGET_URL=${TARGET_URL}
    hosts:
      - ${HOSTS}    

  message-router:
    base_image: app-mwa/message-router-pull-unpack-test
    parameters:
      key_group_regex: ^([0-9]+)$
      start_message: ${START_MESSAGE}
    hosts:
      - h0:1
